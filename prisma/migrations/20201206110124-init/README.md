# Migration `20201206110124-init`

This migration has been generated by alexismalzieu at 12/6/2020, 12:01:24 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."System" AS ENUM ('METRIC', 'US')

CREATE TABLE "Recipe" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "prepTime" INTEGER,
    "cookingTime" INTEGER,
    "instructionId" INTEGER,
    "sourceUrl" TEXT,

    PRIMARY KEY ("id")
)

CREATE TABLE "Ingredient" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "alternativeingredientId" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "IngredientsOnRecipe" (
"id" SERIAL,
    "recipeId" INTEGER NOT NULL,
    "ingredientId" INTEGER NOT NULL,
    "base_amout" INTEGER,
    "unitId" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "Unit" (
"id" SERIAL,
    "system" "System" NOT NULL,
    "symbol" TEXT NOT NULL,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Tag" (
"id" SERIAL,
    "kind" TEXT NOT NULL,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Instruction" (
"id" SERIAL,
    "recipeId" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "InstructionStep" (
"id" SERIAL,
    "body" TEXT NOT NULL,
    "instructionId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_RecipeToTag" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "_RecipeToTag_AB_unique" ON "_RecipeToTag"("A", "B")

CREATE INDEX "_RecipeToTag_B_index" ON "_RecipeToTag"("B")

ALTER TABLE "Recipe" ADD FOREIGN KEY("instructionId")REFERENCES "Instruction"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Ingredient" ADD FOREIGN KEY("alternativeingredientId")REFERENCES "Ingredient"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "IngredientsOnRecipe" ADD FOREIGN KEY("recipeId")REFERENCES "Recipe"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "IngredientsOnRecipe" ADD FOREIGN KEY("ingredientId")REFERENCES "Ingredient"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "IngredientsOnRecipe" ADD FOREIGN KEY("unitId")REFERENCES "Unit"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Instruction" ADD FOREIGN KEY("recipeId")REFERENCES "Instruction"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "InstructionStep" ADD FOREIGN KEY("instructionId")REFERENCES "Instruction"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_RecipeToTag" ADD FOREIGN KEY("A")REFERENCES "Recipe"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_RecipeToTag" ADD FOREIGN KEY("B")REFERENCES "Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201206110124-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,79 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model Recipe {
+  id                  Int                   @id @default(autoincrement())
+  name                String
+  prepTime            Int?
+  cookingTime         Int?
+  instruction         Instruction?          @relation(fields: [instructionId], references: [id])
+  instructionId       Int?
+  tags                Tag[]
+  sourceUrl           String?
+  IngredientsOnRecipe IngredientsOnRecipe[]
+}
+
+model Ingredient {
+  id                        Int                   @id @default(autoincrement())
+  name                      String
+  alternativeNames          Ingredient[]          @relation("IngredientToIngredient")
+  alternativeIngredientName Ingredient?           @relation("IngredientToIngredient", fields: [alternativeingredientId], references: [id])
+  alternativeingredientId   Int?
+  IngredientsOnRecipe       IngredientsOnRecipe[]
+}
+
+model IngredientsOnRecipe {
+  id           Int        @id @default(autoincrement())
+  recipe       Recipe     @relation(fields: [recipeId], references: [id])
+  recipeId     Int
+  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])
+  ingredientId Int
+  base_amout   Int?
+  base_unit    Unit?      @relation(fields: [unitId], references: [id])
+  unitId       Int?
+}
+
+enum System {
+  METRIC
+  US
+}
+
+model Unit {
+  id                   Int                   @id @default(autoincrement())
+  system               System
+  symbol               String
+  name                 String
+  IngredientsOnRecipes IngredientsOnRecipe[]
+}
+
+model Tag {
+  id      Int      @id @default(autoincrement())
+  kind    String
+  name    String
+  recipes Recipe[]
+}
+
+model Instruction {
+  id          Int               @id @default(autoincrement())
+  steps       InstructionStep[]
+  recipe      Instruction?      @relation(fields: [recipeId], references: [id])
+  recipeId    Int?
+  Recipe      Recipe[]
+  Instruction Instruction[]     @relation("InstructionToInstruction")
+}
+
+model InstructionStep {
+  id            Int         @id @default(autoincrement())
+  body          String
+  instruction   Instruction @relation(fields: [instructionId], references: [id])
+  instructionId Int
+}
```


